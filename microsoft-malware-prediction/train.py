import pandas as pd
import glob
import shutil
import sys
import numpy as np
from IPython.display import display, HTML
import matplotlib.pyplot as plt
import math
from time import time
from sklearn.impute import SimpleImputer
from sklearn.naive_bayes import GaussianNB
from sklearn.metrics import accuracy_score
from sklearn.metrics import fbeta_score
from sklearn.model_selection import train_test_split
from xgboost import XGBClassifier
import pickle
from scipy.special import boxcox1p
import os
from past.builtins import execfile
from sklearn.utils import shuffle


from process_df import process_df, train_predict

file = 'data/train.csv'
df = pd.read_csv(file)
print("Read done")

df = shuffle(df)
print("Shuffle done")

print(df.shape)
newlen = int(len(df.index) / 10)
df = df[:newlen]
print(df.shape)
print("Reduce data set done")

drop_list2 = ['MachineIdentifier']
df.drop(drop_list2, axis=1, inplace=True)
print("Drop done")

# Split the data in features and target label
labels = df['HasDetections']
features = df.drop('HasDetections', axis=1)
print("Split done")

features = process_df(features)
print("Process done")

# labels.to_pickle('labels.pkl')
# features.to_pickle('labels.pkl')

X_train, X_test, y_train, y_test = train_test_split(features, labels, test_size = 0.2, random_state = 0)
print("Train-Test split done")

# clf = GaussianNB()
clf = XGBClassifier()
print("CLF assignment done")

trained_model = train_predict(clf, len(y_train), X_train, y_train, X_test, y_test)
print("Train-Predict done")
with open('trained_model.pkl', 'wb') as f:
    pickle.dump(clf, f)
print("PKL Write done")

print('Training done')
